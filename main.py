import os
import struct
import random

os.makedirs("input", exist_ok=True)
os.makedirs("output", exist_ok=True)
cwd = os.getcwd()

avatarid = 1
input_dir = os.path.join(cwd, "input")
output_dir = os.path.join(cwd, "output", "avatars")

avatar_list = sorted(os.listdir(input_dir), key=lambda x: int(x.split(".")[0]))


for avatarname in avatar_list:
    str_avatarid = str(avatarid).zfill(4)
    print(avatarname + " - " + str_avatarid)
    
    avatar_dir = os.path.join(output_dir, "ui_avatar_" + str_avatarid)
    os.makedirs(avatar_dir, exist_ok=True)
    
    textures_dir = os.path.join(avatar_dir, "textures")
    os.makedirs(textures_dir, exist_ok=True)
    
    input_file = os.path.join(input_dir, avatarname)
    output_file = os.path.join(textures_dir, "avatar.tga.ckd")
    os.rename(input_file, output_file)
    
    avatardesc_file = os.path.join(avatar_dir, "avatardesc.tpl.ckd")
    with open(avatardesc_file, 'wb') as avtrdesc:
        avtrdesc.write(bytes.fromhex("00000001000001541B857BCE000000AC000000000000000000000000000000000000000000000000000000000000000127C6D33900000094"))
        avtrdesc.write(bytes.fromhex("00000005"))  # gameversion
        unlockable = input("Do you want to make avatar " + str_avatarid + " unlockable? Y or N\nInput here: ")
        if unlockable=="Y" or unlockable=="y":
            pricequestion = input("Unlockable by Mojo or by map played? Y for Mojo. N for map played.: ")
            if pricequestion=="Y" or pricequestion=="y":
                avtrdesc.write(bytes.fromhex("00000000"))  #00 00 00 00
                avtrdir = "world/jd5/_ui/ui_avatars/" + "ui_avatar_" + str_avatarid + "/"
                avtrdesc.write(struct.pack(">I", len(avtrdir)))
                avtrdesc.write(avtrdir.encode())
                avtract = "ui_avatar_" + str_avatarid + ".act"
                avtrdesc.write(struct.pack(">I", len(avtract)))
                avtrdesc.write(avtract.encode())
                randid=str(random.randint(10000000, 99999999))
                avtrdesc.write(bytes.fromhex(randid+"00000000"))
                avtrdesc.write(avatarid.to_bytes(4, 'big')) #id do avatar
                avtrdesc.write(bytes.fromhex("0000000100000001"))
                priceavtr=input("price? 5/10/500: ")
                if priceavtr > 500:
                    print("It's not possible to set an avatar above 500 Mojos, so it will be set to 500.")
                    avtrdesc.write(int(500).to_bytes(4, 'big')) #preco
                avtrdesc.write(int(priceavtr).to_bytes(4, 'big')) #preco
                avtrdesc.write(bytes.fromhex("FFFFFFFF00000001"))
            else:
                mapname=input("mapname: ")
                avtrdesc.write(struct.pack(">I", len(mapname)))
                avtrdesc.write(mapname.encode())
                avtrdir = "world/jd5/_ui/ui_avatars/" + "ui_avatar_" + str_avatarid + "/"
                avtrdesc.write(struct.pack(">I", len(avtrdir)))
                avtrdesc.write(avtrdir.encode())
                avtract = "ui_avatar_" + str_avatarid + ".act"
                avtrdesc.write(struct.pack(">I", len(avtract)))
                avtrdesc.write(avtract.encode())
                randid=str(random.randint(10000000, 99999999))
                avtrdesc.write(bytes.fromhex(randid+"00000000"))
                avtrdesc.write(avatarid.to_bytes(4, 'big')) #id do avatar
                avtrdesc.write(bytes.fromhex("0000000100000003FFFFFFFFFFFFFFFF00000001"))
        else:
            avtrdesc.write(bytes.fromhex("00000000"))  #00 00 00 00
            avtrdir = "world/jd5/_ui/ui_avatars/" + "ui_avatar_" + str_avatarid + "/"
            avtrdesc.write(struct.pack(">I", len(avtrdir)))
            avtrdesc.write(avtrdir.encode())
            avtract = "ui_avatar_" + str_avatarid + ".act"
            avtrdesc.write(struct.pack(">I", len(avtract)))
            avtrdesc.write(avtract.encode())
            randid=str(random.randint(10000000, 99999999))
            avtrdesc.write(bytes.fromhex(randid+"00000000"))
            avtrdesc.write(avatarid.to_bytes(4, 'big')) #id do avatar
            avtrdesc.write(bytes.fromhex("0000000300000000FFFFFFFFFFFFFFFF00000001"))  #Ending
    avataract_file = os.path.join(avatar_dir, "ui_avatar_"+str_avatarid+".act.ckd")    
    with open(avataract_file, 'wb') as avtract:
        avtract.write(bytes.fromhex("00000001000000003F8000003F8000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFF00000000"))
        avtrdir = "world/jd5/_ui/ui_avatars/" + "ui_avatar_" + str_avatarid + "/"        
        avtract.write(struct.pack(">I", len(avtrdir)))
        avtract.write(avtrdir.encode())
        actfile = "ui_avatar_" + str_avatarid + ".tpl"
        avtract.write(struct.pack(">I", len(actfile)))
        avtract.write(actfile.encode())
        randid=str(random.randint(10000000, 99999999))
        avtract.write(bytes.fromhex(randid+"000000000000000000000003A6E4EFBA3F8000003F8000003F8000003F800000000000003F800000000000003F800000000000000000000000000000000000003F8000000000000000000001000000000000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000FFFFFFFF000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFF00000000FFFFFFFFFFFFFFFF7DD8643C000000008D4FFFB60000000000000000"))
    
    avatardescact_file = os.path.join(avatar_dir, "avatardesc.act.ckd")
    with open(avatardescact_file, 'wb') as avtrdescact:
        avtrdescact.write(bytes.fromhex("00000001000000003F8000003F8000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFF00000000"))
        avtrdir = "world/jd5/_ui/ui_avatars/" + "ui_avatar_" + str_avatarid + "/"        
        avtrdescact.write(struct.pack(">I", len(avtrdir)))
        avtrdescact.write(avtrdir.encode())
        actfile = "avatardesc.tpl"
        avtrdescact.write(struct.pack(">I", len(actfile)))
        avtrdescact.write(actfile.encode())
        randid=str(random.randint(10000000, 99999999))
        avtrdescact.write(bytes.fromhex(randid+"0000000000000000000000011759E29D"))
    
    uiavatartpl_file = os.path.join(avatar_dir, "ui_avatar_"+str_avatarid+".tpl.ckd")
    with open(uiavatartpl_file, 'wb') as avatartpl:
        avatartpl.write(bytes.fromhex("00000001000019EC1B857BCE000000AC0000000000000000000000000000000000000000000000000000000000000003A3557351000003D8000000000000000200000002000000100000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000003FE666663E99999A0000015C000000240000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF00000000000000000000000000000000FFFFFFFF00000000000000180000000000000000FFFFFFFFFFFFFFFF3F80000040800000000000000000000000000000000000000000000000000000000000010000000000000001FFFFFFFF0000017C00000006000000A89DD108C900000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000D615F686170707930312E616E6D8DA85F70000000003F80000000000000000000010000000000000000FFFFFFFFFFFFFFFF0000000000000000000000003F800000000000013F80000000000000000000A8CA41998C00000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F00000011625F7361645F616E67727930312E616E6D41E3F6A8000000003F80000000000000000000010000000000000000FFFFFFFFFFFFFFFF0000000000000000000000003F800000000000013F80000000000000000000A8785A2F6B00000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000C635F6C6F766530312E616E6D24CBFE01000000003F80000000000000000000010000000000000000FFFFFFFFFFFFFFFF0000000000000000000000003F800000000000013F80000000000000000000A8B1BB5C9800000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000D645F7461756E7430312E616E6D38CCEA0A000000003F80000000000000000000010000000000000000FFFFFFFFFFFFFFFF0000000000000000000000003F800000000000013F80000000000000000000A835F9F40500000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000C7374616E646172642E616E6DFC612EC3000000003F80000000000000000000010000000000000000FFFFFFFFFFFFFFFF0000000000000000000000003F800000000000013F80000000000000000000A86158A88A00000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000869646C652E616E6D14CFB407000000003F80000000000001000000010000000000000000FFFFFFFFFFFFFFFF0000000000000000000000003F800000000000013F8000000000000000000000000000D800000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000001775695F6176617461725F737175656C65746F6E2E736B6CF13BAC4D0000000000000002000000D4781CB96100000033776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F74657874757265732F0000000E656666656374735F30302E70626B243ECFAC000000000000002400000033776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F74657874757265732F0000000E656666656374735F30302E7467619FBA0359000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF00000000000000D418AF6D8D00000033776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F74657874757265732F0000000A6176617461722E70626BE6C6F0A10000000000000024"))
        avtrdir = "world/jd5/_ui/ui_avatars/" + "ui_avatar_" + str_avatarid + "/textures/"
        
        avatartpl.write(struct.pack(">I", len(avtrdir)))
        avatartpl.write(avtrdir.encode())
        actfile = "avatar.tga"
        avatartpl.write(struct.pack(">I", len(actfile)))
        avatartpl.write(actfile.encode())
        randid=str(random.randint(10000000, 99999999))
        avatartpl.write(bytes.fromhex(randid+"000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF000000000000000000000000FFFFFFFF00000000000000060000006C35F9F40500000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000C7374616E646172642E616E6DFC612EC30000000000000010C000E77CC000E94A3FFCDFD03FE865970000006CCA41998C00000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F00000011625F7361645F616E67727930312E616E6D41E3F6A80000000000000010C0009C50C001B0DE400B37C63FBE99430000006C785A2F6B00000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000C635F6C6F766530312E616E6D24CBFE010000000000000010BFB0B461BFBDF32D401D7954401A786F0000006CE342355000000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000D615F686170707930312E616E6D8DA85F700000000000000010BFE164FEBFFAC1803FF6F0E640206E010000006CB1BB5C9800000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000D645F7461756E7430312E616E6D38CCEA0A0000000000000010C026E0E0BFBDF32D3FF101FC3FBFF1F50000006C6158A88A00000034776F726C642F6A64352F5F75692F75695F617661746172732F75695F6176617461725F636F6D6D6F6E2F616E696D6174696F6E2F0000000869646C652E616E6D14CFB4070000000000000010BFB1F1FCBFDDBB794042275F4040F23E0000000000000000000000006158A88AFFFFFFFF3F8000003F8000003F8000003F8000000000000000000000000000000000000000000000000000000000000000000000000000003F8000003F80000000000000D94D6C53000000A4000000050000011022E01AEF0000000018AF6D8DA221BCAA00000001000000010000000000000000000000030000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F000000176176617461725F616E6772795F626F795F30352E776176EFD413E1000000000000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F000000176176617461725F616E6772795F626F795F30332E77617698A3CAB0000000000000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F000000176176617461725F616E6772795F626F795F30342E776176F3D586F600000000000000000000000000000000000000000000000000000064000000010000000000000002FFFFFFFF000000000000000000000000000000003F8000003F800000000000003E4CCCCD0000000000000002FFFFFFFFFFFFFFFF00000000000000000000000000000000FFFFFFFF00000001000001103AA6F0F10000000018AF6D8DA221BCAA00000001000000010000000000000000000000010000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F0000000E6176617461725F67756D2E776176830E438B00000000000000000000000000000000000000000000000000000064000000010000000000000002FFFFFFFF000000000000000000000000000000003F8000003F800000000000003E4CCCCD0000000000000002FFFFFFFFFFFFFFFF00000000000000000000000000000000FFFFFFFF000000010000011084104FE10000000018AF6D8DA221BCAA00000001000000010000000000000000000000020000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F000000166176617461725F6C6F76655F626F795F30312E77617682A6ADDF000000000000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F000000176176617461725F6C6F76655F6769726C5F30312E7761764F317E1F00000000000000000000000000000000000000000000000000000064000000010000000000000002FFFFFFFF000000000000000000000000000000003F8000003F800000000000003E4CCCCD0000000000000002FFFFFFFFFFFFFFFF00000000000000000000000000000000FFFFFFFF000000010000011046CACD610000000018AF6D8DA221BCAA00000001000000010000000000000000000000040000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F0000001A6176617461725F7374616E646172645F626F795F30322E776176656C6BEA000000000000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F0000001A6176617461725F7374616E646172645F626F795F30332E7761766D2FE83C000000000000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F0000001A6176617461725F7374616E646172645F626F795F30342E776176CFF0A346000000000000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F0000001A6176617461725F7374616E646172645F626F795F30352E776176AE54A9BE00000000000000000000000000000000000000000000000000000064000000010000000000000002FFFFFFFF000000000000000000000000000000003F8000003F800000000000003E4CCCCD0000000000000002FFFFFFFFFFFFFFFF00000000000000000000000000000000FFFFFFFF0000000100000110D0910C5B0000000018AF6D8DA221BCAA00000001000000010000000000000000000000030000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F000000176176617461725F68617070795F626F795F30332E77617645278BA4000000000000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F000000176176617461725F68617070795F626F795F30342E776176738603C3000000000000001C776F726C642F6A64352F5F617564696F2F75692F617661746172732F000000176176617461725F68617070795F626F795F30352E7761762D99D8F500000000000000000000000000000000000000000000000000000064000000010000000000000002FFFFFFFF000000000000000000000000000000003F8000003F800000000000003E4CCCCD0000000000000002FFFFFFFFFFFFFFFF00000000000000000000000000000000FFFFFFFF00000001FFFFFFFF0000000000000000000000000E355C680000007C00000001112D880600000005000000783426BA9E000000000000000000000001000000010000000000000001FFFFFFFF000000000000000146CACD610000000000000001FFFFFFFFFFFFFFFFFFFFFFFF00000078CE7AA029000000000000000000000001000000010000000000000001FFFFFFFF000000000000000122E01AEF0000000000000001FFFFFFFFFFFFFFFFFFFFFFFF00000078E28C7267000000000000000000000001000000010000000000000001FFFFFFFF000000000000000184104FE10000000000000001FFFFFFFFFFFFFFFFFFFFFFFF0000007872F530C8000000000000000000000001000000010000000000000001FFFFFFFF00000000000000013AA6F0F10000000000000001FFFFFFFFFFFFFFFFFFFFFFFF000000782F35E5EA000000000000000000000001000000010000000000000001FFFFFFFF0000000000000001D0910C5B0000000000000001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000"))
    avatarid += 1

#skuscene 
avtrsku = open("output\\skuscene_avatars.isc.ckd", "wb")
avtrsku.write(bytes.fromhex("0000000100000000000000000000000000000000"))
avtrsku.write(avatarid.to_bytes(4, 'big'))

str_avatarid = "avatardesc@" + str(1)
avtrsku.write(bytes.fromhex("97CA628B358637BD3F8000003F80000000000000"))
avtrsku.write(struct.pack(">I", len(str_avatarid)))
avtrsku.write(str_avatarid.encode())
avtrsku.write(bytes.fromhex("000000004014FA9C3F86CA58000000000000000000000000FFFFFFFF00000000"))

avtrdir = "world/jd5/_ui/ui_avatars/" + "ui_avatar_" + str(1).zfill(4) + "/"
avtrsku.write(struct.pack(">I", len(avtrdir)))
avtrsku.write(avtrdir.encode())

actfile = "avatardesc.tpl"
avtrsku.write(struct.pack(">I", len(actfile)))
avtrsku.write(actfile.encode())
randid = str(random.randint(10000000, 99999999))
avtrsku.write(bytes.fromhex(randid + "0000000000000000000000011759E29D97CA628B358637BD3F8000003F80000000000000"))

for i in range(2, avatarid):
    str_avatarid = "avatardesc@" + str(i)
    avtrsku.write(struct.pack(">I", len(str_avatarid)))
    avtrsku.write(str_avatarid.encode())
    avtrsku.write(bytes.fromhex("000000004014FA9C3F86CA58000000000000000000000000FFFFFFFF00000000"))

    avtrdir = "world/jd5/_ui/ui_avatars/" + "ui_avatar_" + str(i).zfill(4) + "/"
    avtrsku.write(struct.pack(">I", len(avtrdir)))
    avtrsku.write(avtrdir.encode())

    actfile = "avatardesc.tpl"
    avtrsku.write(struct.pack(">I", len(actfile)))
    avtrsku.write(actfile.encode())
    randid = str(random.randint(10000000, 99999999))
    avtrsku.write(bytes.fromhex(randid + "0000000000000000000000011759E29D97CA628B358637BD3F8000003F80000000000000"))

avatardesconly = "avatardesc"
avtrsku.write(struct.pack(">I", len(avatardesconly)))
avtrsku.write(avatardesconly.encode())
avtrsku.write(bytes.fromhex("00000000BFFD07183F4E8566000000000000000000000000FFFFFFFF00000000"))

avtrdir2 = "world/jd5/_ui/ui_avatars/ui_avatar_common/"
avtrsku.write(struct.pack(">I", len(avtrdir2)))
avtrsku.write(avtrdir2.encode())

avtrsku.write(struct.pack(">I", len(actfile)))
avtrsku.write(actfile.encode())
random2 = str(random.randint(10000000, 99999999))
avtrsku.write(bytes.fromhex(random2 + "0000000000000000000000011759E29D000000000000000000000001F878DC2D000000000000000000000000FFFFFFFF0000000000000000"))
avtrsku.close()